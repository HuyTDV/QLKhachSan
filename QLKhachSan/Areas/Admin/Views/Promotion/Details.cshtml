@model QLKhachSan.Models.Promotion

@{
    ViewData["Title"] = "Chi tiết Khuyến mãi";
    var today = DateOnly.FromDateTime(DateTime.Now);
    var isActive = Model.StartDate <= today && Model.EndDate >= today;
    var isUpcoming = Model.StartDate > today;
    var isExpired = Model.EndDate < today;

    // Tính số ngày còn lại
    int daysRemaining = 0;
    if (Model.EndDate.HasValue && isActive)
    {
        daysRemaining = Model.EndDate.Value.DayNumber - today.DayNumber;
    }
}

<div class="container-fluid">
    <div class="row">
        <div class="col-md-10 offset-md-1">
            <div class="card">
                <div class="card-header bg-gradient-primary text-white">
                    <h3 class="card-title">Chi tiết Khuyến mãi</h3>
                </div>
                <div class="card-body">

                    @if (isActive)
                    {
                        <div class="alert alert-success">
                            <i class="fas fa-check-circle"></i>
                            <strong>Khuyến mãi đang áp dụng!</strong> Còn <strong>@daysRemaining ngày</strong>
                        </div>
                    }
                    else if (isUpcoming)
                    {
                        <div class="alert alert-info">
                            <i class="fas fa-clock"></i>
                            <strong>Khuyến mãi sắp diễn ra</strong>
                        </div>
                    }
                    else if (isExpired)
                    {
                        <div class="alert alert-danger">
                            <i class="fas fa-times-circle"></i>
                            <strong>Khuyến mãi đã hết hạn</strong>
                        </div>
                    }

                    <dl class="row">
                        <dt class="col-sm-3">ID</dt>
                        <dd class="col-sm-9">@Model.PromotionId</dd>

                        <dt class="col-sm-3">Mã khuyến mãi</dt>
                        <dd class="col-sm-9">
                            <div class="p-3 bg-light border rounded">
                                <h3 class="text-primary mb-0">
                                    <i class="fas fa-tag"></i> @Model.Code
                                </h3>
                            </div>
                        </dd>

                        <dt class="col-sm-3">Mô tả</dt>
                        <dd class="col-sm-9">
                            <p>@Model.Description</p>
                        </dd>

                        <dt class="col-sm-3">Phần trăm giảm giá</dt>
                        <dd class="col-sm-9">
                            <h2>
                                <span class="badge badge-success" style="font-size: 1.5em;">
                                    <i class="fas fa-percentage"></i> @Model.DiscountPercent%
                                </span>
                            </h2>
                        </dd>

                        <dt class="col-sm-3">Thời gian áp dụng</dt>
                        <dd class="col-sm-9">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="info-box bg-info">
                                        <span class="info-box-icon">
                                            <i class="fas fa-play-circle"></i>
                                        </span>
                                        <div class="info-box-content">
                                            <span class="info-box-text">Ngày bắt đầu</span>
                                            <span class="info-box-number">
                                                @Model.StartDate?.ToString("dd/MM/yyyy")
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="info-box bg-warning">
                                        <span class="info-box-icon">
                                            <i class="fas fa-stop-circle"></i>
                                        </span>
                                        <div class="info-box-content">
                                            <span class="info-box-text">Ngày kết thúc</span>
                                            <span class="info-box-number">
                                                @Model.EndDate?.ToString("dd/MM/yyyy")
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </dd>

                        <dt class="col-sm-3">Trạng thái hiện tại</dt>
                        <dd class="col-sm-9">
                            @if (isActive)
                            {
                                <h4>
                                    <span class="badge badge-success" style="font-size: 1.2em;">
                                        <i class="fas fa-check-circle"></i> Đang áp dụng
                                    </span>
                                </h4>
                            }
                            else if (isUpcoming)
                            {
                                <h4>
                                    <span class="badge badge-info" style="font-size: 1.2em;">
                                        <i class="fas fa-clock"></i> Sắp diễn ra
                                    </span>
                                </h4>
                            }
                            else if (isExpired)
                            {
                                <h4>
                                    <span class="badge badge-danger" style="font-size: 1.2em;">
                                        <i class="fas fa-times-circle"></i> Đã hết hạn
                                    </span>
                                </h4>
                            }
                        </dd>
                    </dl>

                    @if (isActive && Model.StartDate.HasValue && Model.EndDate.HasValue)
                    {
                        var totalDays = Model.EndDate.Value.DayNumber - Model.StartDate.Value.DayNumber;
                        var passedDays = today.DayNumber - Model.StartDate.Value.DayNumber;
                        var progressPercent = (passedDays * 100.0 / totalDays);

                        <hr />
                        <h5>Tiến độ khuyến mãi</h5>
                        <div class="progress" style="height: 25px;">
                            <div class="progress-bar bg-success progress-bar-striped progress-bar-animated"
                                 role="progressbar"
                                 style="width: @progressPercent%"
                                 aria-valuenow="@progressPercent"
                                 aria-valuemin="0"
                                 aria-valuemax="100">
                                @progressPercent.ToString("F1")% (@daysRemaining ngày còn lại)
                            </div>
                        </div>
                    }
                </div>
                <div class="card-footer">
                    <a asp-action="Edit" asp-route-id="@Model.PromotionId" class="btn btn-warning">
                        <i class="fas fa-edit"></i> Sửa
                    </a>
                    <a asp-action="Delete" asp-route-id="@Model.PromotionId" class="btn btn-danger">
                        <i class="fas fa-trash"></i> Xóa
                    </a>
                    <a asp-action="Index" class="btn btn-secondary">
                        <i class="fas fa-arrow-left"></i> Quay lại
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>